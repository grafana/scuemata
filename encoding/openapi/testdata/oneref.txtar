-- in.cue --
package generate

import "github.com/grafana/thema"

thema.#Lineage
name: "oneref"
seqs: [
    {
        schemas: [
            {
                foo: string
                Bar: int32
                baz: #Baz

                #Baz: {
                    run: string
                    tell: bytes
                    dat: int32
                }
            }
        ]
    }
]
-- out/generate/0.0/expandrefs --
"openapi": "3.0.0"
"info": {
	"title":   "oneref"
	"version": "0.0"
}
"paths": {}
"components": {
	"schemas": {
		"Baz": {
			"type": "object", "required": ["run", "tell", "dat"]
			"properties": {
				"run": {
					"type": "string"
				}
				"tell": {
					"type": "string", "format": "binary"
				}
				"dat": {
					"type": "integer", "format": "int32"
				}
			}
		}
		"oneref": {
			"type": "object", "required": ["foo", "Bar", "baz"]
			"properties": {
				"foo": {
					"type": "string"
				}
				"Bar": {
					"type": "integer", "format": "int32"
				}
				"baz": {
					"type": "object", "required": ["run", "tell", "dat"]
					"properties": {
						"run": {
							"type": "string"
						}
						"tell": {
							"type": "string", "format": "binary"
						}
						"dat": {
							"type": "integer", "format": "int32"
						}
					}
				}
			}
		}
	}
}

-- out/generate/0.0/group --
{
	"openapi": "3.0.0"
	"info": {
		"title":   "oneref"
		"version": "0.0"
	}
	"path": {}
	"components": {
		"schemas": {
			"foo": {
				"type": "string"
			}
			"Bar": {
				"type": "integer", "format": "int32"
			}
			"baz": {
				"type": "object", "required": ["run", "tell", "dat"]
				"properties": {
					"run": {
						"type": "string"
					}
					"tell": {
						"type": "string", "format": "binary"
					}
					"dat": {
						"type": "integer", "format": "int32"
					}
				}
			}
			"Baz": {
				"type": "object", "required": ["run", "tell", "dat"]
				"properties": {
					"run": {
						"type": "string"
					}
					"tell": {
						"type": "string", "format": "binary"
					}
					"dat": {
						"type": "integer", "format": "int32"
					}
				}
			}
		}
	}
}

-- out/generate/0.0/nil --
"openapi": "3.0.0"
"info": {
	"title":   "oneref"
	"version": "0.0"
}
"paths": {}
"components": {
	"schemas": {
		"Baz": {
			"type": "object", "required": ["run", "tell", "dat"]
			"properties": {
				"run": {
					"type": "string"
				}
				"tell": {
					"type": "string", "format": "binary"
				}
				"dat": {
					"type": "integer", "format": "int32"
				}
			}
		}
		"oneref": {
			"type": "object", "required": ["foo", "Bar", "baz"]
			"properties": {
				"foo": {
					"type": "string"
				}
				"Bar": {
					"type": "integer", "format": "int32"
				}
				"baz": {
					"$ref": "#/components/schemas/Baz"
				}
			}
		}
	}
}

-- out/generate/0.0/selfcontained --
"openapi": "3.0.0"
"info": {
	"title":   "oneref"
	"version": "0.0"
}
"paths": {}
"components": {
	"schemas": {
		"Baz": {
			"type": "object", "required": ["run", "tell", "dat"]
			"properties": {
				"run": {
					"type": "string"
				}
				"tell": {
					"type": "string", "format": "binary"
				}
				"dat": {
					"type": "integer", "format": "int32"
				}
			}
		}
		"oneref": {
			"type": "object", "required": ["foo", "Bar", "baz"]
			"properties": {
				"foo": {
					"type": "string"
				}
				"Bar": {
					"type": "integer", "format": "int32"
				}
				"baz": {
					"$ref": "#/components/schemas/Baz"
				}
			}
		}
	}
}

-- out/generate/0.0/selfcontained --
"openapi": "3.0.0"
"info": {
	"title":   "oneref"
	"version": "0.0"
}
"paths": {}
"components": {
	"schemas": {
		"Baz": {
			"type": "object", "required": ["run", "tell", "dat"]
			"properties": {
				"run": {
					"type": "string"
				}
				"tell": {
					"type": "string", "format": "binary"
				}
				"dat": {
					"type": "integer", "format": "int32"
				}
			}
		}
		"oneref": {
			"type": "object", "required": ["foo", "Bar", "baz"]
			"properties": {
				"foo": {
					"type": "string"
				}
				"Bar": {
					"type": "integer", "format": "int32"
				}
				"baz": {
					"$ref": "#/components/schemas/Baz"
				}
			}
		}
	}
}

-- out/generate/0.0/subpath/err --
#someField: openapi: #someField: field not found: someField
-- out/generate/0.0/subpath/err --
#someField: openapi: #someField: field not found: someField
-- out/generate/0.0/subpathroot/err --
#overriddenName: openapi: #overriddenName: field not found: someField
